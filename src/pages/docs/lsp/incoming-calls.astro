---
import DocsLayout from '../../../layouts/Docs.astro';
import CodeBlock from '../../../components/docs/CodeBlock.astro';
import Callout from '../../../components/docs/Callout.astro';
import PrevNext from '../../../components/docs/PrevNext.astro';
import ScreenshotPlaceholder from '../../../components/docs/ScreenshotPlaceholder.astro';
---

<DocsLayout title="incomingCalls" description="Find all functions that call a specific function using LSP call hierarchy">
  <h1 class="text-4xl font-bold text-text-primary mb-4">incomingCalls</h1>
  <p class="text-xl text-text-secondary mb-8">
    Find all functions that call a specific function using LSP call hierarchy.
  </p>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-text-primary mb-4">Overview</h2>
    <p class="text-text-secondary mb-4">
      The <code class="px-2 py-1 bg-bg-subtle rounded text-primary">incomingCalls</code> tool identifies all
      functions that call a specific function at a given location. This is essential for understanding code
      dependencies and performing impact analysis before refactoring.
    </p>
  </section>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-text-primary mb-4">How It Works</h2>
    <p class="text-text-secondary mb-4">
      This tool leverages the Language Server Protocol (LSP) call hierarchy feature to traverse the codebase
      and find all call sites:
    </p>
    <ol class="list-decimal list-inside text-text-secondary space-y-2 ml-4">
      <li>Sends a <code class="px-2 py-1 bg-bg-subtle rounded text-primary">textDocument/prepareCallHierarchy</code> request to identify the symbol at the given position</li>
      <li>Uses the prepared item to request <code class="px-2 py-1 bg-bg-subtle rounded text-primary">callHierarchy/incomingCalls</code></li>
      <li>Returns a list of all functions that contain calls to the target function</li>
    </ol>
  </section>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-text-primary mb-4">Parameters</h2>
    <div class="overflow-x-auto">
      <table class="w-full text-sm text-left text-text-secondary">
        <thead class="text-xs uppercase bg-bg-subtle text-text-muted">
          <tr>
            <th class="py-3 px-4 rounded-tl-lg">Parameter</th>
            <th class="py-3 px-4">Type</th>
            <th class="py-3 px-4">Required</th>
            <th class="py-3 px-4 rounded-tr-lg">Description</th>
          </tr>
        </thead>
        <tbody class="bg-bg-subtle">
          <tr class="border-b border-border">
            <td class="py-3 px-4 font-medium text-text-primary"><code class="text-primary">file_path</code></td>
            <td class="py-3 px-4">string</td>
            <td class="py-3 px-4"><span class="text-danger">Yes</span></td>
            <td class="py-3 px-4">Absolute path to the file containing the target function</td>
          </tr>
          <tr class="border-b border-border">
            <td class="py-3 px-4 font-medium text-text-primary"><code class="text-primary">line</code></td>
            <td class="py-3 px-4">number</td>
            <td class="py-3 px-4"><span class="text-danger">Yes</span></td>
            <td class="py-3 px-4">Line number of the function (0-indexed)</td>
          </tr>
          <tr>
            <td class="py-3 px-4 font-medium text-text-primary"><code class="text-primary">character</code></td>
            <td class="py-3 px-4">number</td>
            <td class="py-3 px-4"><span class="text-danger">Yes</span></td>
            <td class="py-3 px-4">Character offset within the line (0-indexed)</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-text-primary mb-4">Example</h2>
    <p class="text-text-secondary mb-4">
      Ask Claude to find all incoming calls to a function. The output shows all functions that call the target function with their locations.
    </p>
    <ScreenshotPlaceholder
      path="lsp/incoming-calls-example.png"
      alt="incomingCalls LSP operation invocation and output"
      caption="Finding all callers of a function"
    />
  </section>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-text-primary mb-4">Use Cases</h2>
    <ul class="list-disc list-inside text-text-secondary space-y-2 ml-4">
      <li><strong class="text-text-primary">Impact Analysis:</strong> Understand which parts of your codebase depend on a function before modifying it</li>
      <li><strong class="text-text-primary">Refactoring:</strong> Identify all call sites that need to be updated when changing a function signature</li>
      <li><strong class="text-text-primary">Code Review:</strong> Trace the usage of a function across the project</li>
      <li><strong class="text-text-primary">Dead Code Detection:</strong> Find functions with no incoming calls</li>
    </ul>
  </section>

  <Callout type="tip" title="Pro Tip">
    Combine <code class="text-primary">incomingCalls</code> with <code class="text-primary">get_callees</code>
    to build a complete call graph around a function, showing both what calls it and what it calls.
  </Callout>

  <Callout type="info" title="LSP Requirement">
    This tool requires an active Language Server for the target file's language. Make sure the appropriate
    language server is installed and configured for your project.
  </Callout>

  <PrevNext
    prev={{ title: "get_file_symbols", href: "/docs/tools/get-file-symbols" }}
    next={{ title: "goToImplementation", href: "/docs/lsp/go-to-implementation" }}
  />
</DocsLayout>
