---
import DocsLayout from '../../layouts/Docs.astro';
import CodeBlock from '../../components/docs/CodeBlock.astro';
import Callout from '../../components/docs/Callout.astro';
import PrevNext from '../../components/docs/PrevNext.astro';

const mcpConfig = `{
  "mcpServers": {
    "codegraph": {
      "command": "node",
      "args": ["/absolute/path/to/codegraph/mcp-server/dist/index.js"],
      "env": {
        "NEO4J_URI": "bolt://localhost:7687",
        "NEO4J_USER": "neo4j",
        "NEO4J_PASSWORD": ""
      }
    }
  }
}`;

const dockerCode = `# Check Docker status
docker info

# On macOS, start Docker Desktop from Applications
# On Linux, start the Docker service:
sudo systemctl start docker`;

const neo4jCode = `# Find and stop existing Neo4j containers
docker ps | grep neo4j
docker stop <container_id>

# Or stop all Neo4j containers
docker stop $(docker ps -q --filter ancestor=neo4j)`;
---

<DocsLayout title="Installation">
  <article class="prose prose-invert max-w-none">
    <h1 class="text-4xl font-bold text-white mb-4">Installation</h1>

    <p class="text-xl text-gray-300 mb-8">
      CodeGraph can be installed in two ways: as a Claude Code plugin (recommended) or as a standalone MCP server.
    </p>

    <h2 class="text-2xl font-semibold text-white mt-10 mb-4">Prerequisites</h2>

    <p class="text-gray-300 mb-6">
      Before installing CodeGraph, ensure you have the following:
    </p>

    <div class="space-y-4 mb-8">
      <div class="flex items-start gap-4 bg-gray-800/50 border border-gray-700 rounded-lg p-4">
        <div class="flex-shrink-0 w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center">
          <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
        </div>
        <div>
          <h3 class="text-white font-semibold">Claude Code CLI</h3>
          <p class="text-gray-400 text-sm mt-1">
            The official Claude Code command-line interface.
            <a href="https://claude.ai/code" class="text-emerald-400 hover:text-emerald-300">Install Claude Code</a>
          </p>
        </div>
      </div>

      <div class="flex items-start gap-4 bg-gray-800/50 border border-gray-700 rounded-lg p-4">
        <div class="flex-shrink-0 w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center">
          <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01" />
          </svg>
        </div>
        <div>
          <h3 class="text-white font-semibold">Docker</h3>
          <p class="text-gray-400 text-sm mt-1">
            Required for running the Neo4j database.
            <a href="https://docs.docker.com/get-docker/" class="text-emerald-400 hover:text-emerald-300">Install Docker</a>
          </p>
        </div>
      </div>

      <div class="flex items-start gap-4 bg-gray-800/50 border border-gray-700 rounded-lg p-4">
        <div class="flex-shrink-0 w-10 h-10 bg-orange-500/20 rounded-lg flex items-center justify-center">
          <svg class="w-5 h-5 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
          </svg>
        </div>
        <div>
          <h3 class="text-white font-semibold">Supported Languages</h3>
          <p class="text-gray-400 text-sm mt-1">
            CodeGraph currently supports <strong class="text-white">Kotlin</strong> and <strong class="text-white">Java</strong> projects.
            More languages coming soon.
          </p>
        </div>
      </div>
    </div>

    <!-- Section 1: Claude Code Plugin -->
    <h2 class="text-2xl font-semibold text-white mt-10 mb-4" id="claude-code-plugin">Option 1: Claude Code Plugin (Recommended)</h2>

    <p class="text-gray-300 mb-6">
      The easiest way to use CodeGraph is through the Claude Code plugin. This method provides seamless integration with Claude Code commands and automatic Neo4j management.
    </p>

    <h3 class="text-xl font-semibold text-white mt-8 mb-3">Step 1: Add the Plugin Marketplace</h3>

    <p class="text-gray-300 mb-4">
      First, add the Bikach plugin marketplace to Claude Code:
    </p>

    <CodeBlock
      code="/plugin marketplace add Bikach/claude-plugins"
      lang="bash"
      title="Claude Code"
    />

    <h3 class="text-xl font-semibold text-white mt-8 mb-3">Step 2: Install the Plugin</h3>

    <p class="text-gray-300 mb-4">
      Install the CodeGraph plugin from the marketplace:
    </p>

    <CodeBlock
      code="/plugin install codegraph@Bikach"
      lang="bash"
      title="Claude Code"
    />

    <Callout type="info" title="Installation Scopes">
      You can specify the installation scope:
      <ul class="mt-2 space-y-1">
        <li><code class="bg-gray-800 px-2 py-0.5 rounded text-emerald-400">--scope user</code> - Available in all your projects (default)</li>
        <li><code class="bg-gray-800 px-2 py-0.5 rounded text-emerald-400">--scope project</code> - Shared with collaborators via <code class="bg-gray-800 px-2 py-0.5 rounded text-emerald-400">.claude/settings.json</code></li>
        <li><code class="bg-gray-800 px-2 py-0.5 rounded text-emerald-400">--scope local</code> - Only for you in this repo</li>
      </ul>
    </Callout>

    <h3 class="text-xl font-semibold text-white mt-8 mb-3">Step 3: Initialize CodeGraph</h3>

    <p class="text-gray-300 mb-4">
      Run the setup command to start Neo4j and prepare the database:
    </p>

    <CodeBlock
      code="/codegraph:setup"
      lang="bash"
      title="Claude Code"
    />

    <Callout type="tip" title="What's Included">
      The plugin provides:
      <ul class="mt-2 space-y-1">
        <li><strong class="text-white">3 Claude Code commands:</strong> <code class="bg-gray-800 px-2 py-0.5 rounded text-emerald-400">/codegraph:setup</code>, <code class="bg-gray-800 px-2 py-0.5 rounded text-emerald-400">/codegraph:index</code>, <code class="bg-gray-800 px-2 py-0.5 rounded text-emerald-400">/codegraph:status</code></li>
        <li><strong class="text-white">6 MCP tools:</strong> search_nodes, get_callees, get_neighbors, get_impact, find_path, get_file_symbols</li>
        <li><strong class="text-white">2 LSP tools:</strong> incomingCalls, goToImplementation (via language servers)</li>
      </ul>
    </Callout>

    <!-- Section 2: MCP Standalone -->
    <h2 class="text-2xl font-semibold text-white mt-10 mb-4" id="mcp-standalone">Option 2: MCP Standalone</h2>

    <p class="text-gray-300 mb-6">
      If you prefer more control or want to use CodeGraph with other MCP-compatible clients, you can run the MCP server standalone.
    </p>

    <h3 class="text-xl font-semibold text-white mt-8 mb-3">Step 1: Start Neo4j</h3>

    <p class="text-gray-300 mb-4">
      Start the Neo4j database using Docker Compose:
    </p>

    <CodeBlock
      code="docker-compose up -d"
      lang="bash"
      title="Terminal"
    />

    <h3 class="text-xl font-semibold text-white mt-8 mb-3">Step 2: Build the MCP Server</h3>

    <p class="text-gray-300 mb-4">
      Navigate to the MCP server directory and build it:
    </p>

    <CodeBlock
      code={`cd mcp-server
npm install
npm run build`}
      lang="bash"
      title="Terminal"
    />

    <h3 class="text-xl font-semibold text-white mt-8 mb-3">Step 3: Index Your Project</h3>

    <p class="text-gray-300 mb-4">
      Run the indexing script on your project:
    </p>

    <CodeBlock
      code="npx tsx src/scripts/index-project.ts /path/to/project"
      lang="bash"
      title="Terminal"
    />

    <h3 class="text-xl font-semibold text-white mt-8 mb-3">Step 4: Configure MCP</h3>

    <p class="text-gray-300 mb-4">
      Add the CodeGraph MCP server to your configuration. Edit <code class="bg-gray-800 px-2 py-0.5 rounded text-emerald-400">.mcp.json</code> (project) or <code class="bg-gray-800 px-2 py-0.5 rounded text-emerald-400">~/.claude/claude.json</code> (global):
    </p>

    <CodeBlock
      code={mcpConfig}
      lang="json"
      title=".mcp.json"
    />

    <Callout type="info" title="Standalone Mode Features">
      In standalone mode, you get access to <strong class="text-white">8 MCP tools</strong>:
      <ul class="mt-2 space-y-1">
        <li>search_nodes, get_callees, get_neighbors, get_impact, find_path, get_file_symbols</li>
        <li><strong class="text-white">Plus:</strong> get_callers, get_implementations (graph-based, no LSP required)</li>
      </ul>
      <p class="mt-2 text-yellow-300">Note: Claude Code commands (<code class="bg-gray-800 px-2 py-0.5 rounded text-emerald-400">/codegraph:*</code>) are not available in standalone mode.</p>
    </Callout>

    <!-- Verify Installation -->
    <h2 class="text-2xl font-semibold text-white mt-10 mb-4">Verify Installation</h2>

    <p class="text-gray-300 mb-4">
      After installation, verify that CodeGraph is working correctly:
    </p>

    <CodeBlock
      code="/codegraph:status"
      lang="bash"
      title="Claude Code (Plugin mode only)"
    />

    <p class="text-gray-300 mt-4 mb-4">
      You should see output indicating:
    </p>

    <ul class="list-disc list-inside text-gray-300 space-y-2 mb-6">
      <li>Neo4j connection status (connected)</li>
      <li>Database statistics (nodes, relationships)</li>
      <li>Plugin version information</li>
    </ul>

    <Callout type="tip" title="Quick Test">
      Navigate to a Kotlin or Java project and run <code class="bg-gray-800 px-2 py-0.5 rounded text-emerald-400">/codegraph:index</code>
      to index your first project. Then try asking Claude "What classes are in this project?"
    </Callout>

    <!-- Troubleshooting -->
    <h2 class="text-2xl font-semibold text-white mt-10 mb-4">Troubleshooting</h2>

    <div class="space-y-6 mb-8">
      <div class="border border-gray-700 rounded-lg overflow-hidden">
        <div class="bg-gray-800 px-4 py-3 border-b border-gray-700">
          <h3 class="text-white font-semibold">Docker is not running</h3>
        </div>
        <div class="p-4">
          <p class="text-gray-400 mb-3">
            If you see "Cannot connect to Docker daemon", ensure Docker Desktop is running:
          </p>
          <CodeBlock
            code={dockerCode}
            lang="bash"
          />
        </div>
      </div>

      <div class="border border-gray-700 rounded-lg overflow-hidden">
        <div class="bg-gray-800 px-4 py-3 border-b border-gray-700">
          <h3 class="text-white font-semibold">Neo4j port conflict</h3>
        </div>
        <div class="p-4">
          <p class="text-gray-400 mb-3">
            If port 7687 is already in use, stop any existing Neo4j instances:
          </p>
          <CodeBlock
            code={neo4jCode}
            lang="bash"
          />
        </div>
      </div>

      <div class="border border-gray-700 rounded-lg overflow-hidden">
        <div class="bg-gray-800 px-4 py-3 border-b border-gray-700">
          <h3 class="text-white font-semibold">Plugin not recognized</h3>
        </div>
        <div class="p-4">
          <p class="text-gray-400 mb-3">
            If Claude Code doesn't recognize CodeGraph commands, try restarting Claude Code
            or verify the plugin is correctly listed:
          </p>
          <CodeBlock
            code="/plugin list"
            lang="bash"
            title="Claude Code"
          />
          <p class="text-gray-400 mt-3">
            You should see <code class="bg-gray-800 px-2 py-0.5 rounded text-emerald-400">codegraph@Bikach-claude-plugins</code> in the list.
          </p>
        </div>
      </div>

      <div class="border border-gray-700 rounded-lg overflow-hidden">
        <div class="bg-gray-800 px-4 py-3 border-b border-gray-700">
          <h3 class="text-white font-semibold">Indexing fails or times out</h3>
        </div>
        <div class="p-4">
          <p class="text-gray-400 mb-3">
            For large codebases, indexing may take longer. You can check the status:
          </p>
          <CodeBlock
            code="/codegraph:status"
            lang="bash"
            title="Claude Code"
          />
          <p class="text-gray-400 mt-3">
            If indexing consistently fails, ensure your project is a valid Kotlin or Java project
            with a proper build configuration (Gradle or Maven).
          </p>
        </div>
      </div>
    </div>

    <Callout type="warning" title="Need Help?">
      If you're still experiencing issues, check the
      <a href="https://github.com/Bikach/claude-plugins/issues" class="text-yellow-300 hover:text-yellow-200"> GitHub Issues</a>
      or open a new issue with your error logs.
    </Callout>
  </article>

  <PrevNext
    prev={{ title: "Getting Started", href: "/docs/getting-started" }}
    next={{ title: "/codegraph:setup", href: "/docs/commands/setup" }}
  />
</DocsLayout>
