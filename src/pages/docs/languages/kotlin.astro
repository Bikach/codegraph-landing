---
import DocsLayout from '../../../layouts/Docs.astro';
import CodeBlock from '../../../components/docs/CodeBlock.astro';
import Callout from '../../../components/docs/Callout.astro';
import PrevNext from '../../../components/docs/PrevNext.astro';
---

<DocsLayout title="Kotlin Support" description="Full Kotlin support via kotlin-language-server for code indexing and analysis">
  <h1 class="text-4xl font-bold text-white mb-4">Kotlin Support</h1>
  <p class="text-xl text-gray-400 mb-8">
    Full Kotlin support via kotlin-language-server for comprehensive code indexing and analysis.
  </p>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-white mb-4">Overview</h2>
    <p class="text-gray-300 mb-4">
      CodeGraph provides first-class support for Kotlin projects through integration with the
      <a href="https://github.com/fwcd/kotlin-language-server" target="_blank" rel="noopener" class="text-emerald-400 hover:text-emerald-300 underline">kotlin-language-server</a>.
      This enables full code intelligence including symbol extraction, call hierarchy analysis, and implementation lookup.
    </p>
  </section>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-white mb-4">Supported Features</h2>
    <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
      <div class="p-4 bg-gray-800 rounded-lg border border-gray-700">
        <div class="flex items-center gap-2 mb-2">
          <div class="w-2 h-2 bg-emerald-500 rounded-full"></div>
          <h3 class="text-lg font-semibold text-white">Classes</h3>
        </div>
        <p class="text-gray-400 text-sm">Regular classes, abstract classes, and sealed classes</p>
      </div>
      <div class="p-4 bg-gray-800 rounded-lg border border-gray-700">
        <div class="flex items-center gap-2 mb-2">
          <div class="w-2 h-2 bg-emerald-500 rounded-full"></div>
          <h3 class="text-lg font-semibold text-white">Interfaces</h3>
        </div>
        <p class="text-gray-400 text-sm">Interface declarations with default implementations</p>
      </div>
      <div class="p-4 bg-gray-800 rounded-lg border border-gray-700">
        <div class="flex items-center gap-2 mb-2">
          <div class="w-2 h-2 bg-emerald-500 rounded-full"></div>
          <h3 class="text-lg font-semibold text-white">Functions</h3>
        </div>
        <p class="text-gray-400 text-sm">Top-level functions, extension functions, and methods</p>
      </div>
      <div class="p-4 bg-gray-800 rounded-lg border border-gray-700">
        <div class="flex items-center gap-2 mb-2">
          <div class="w-2 h-2 bg-emerald-500 rounded-full"></div>
          <h3 class="text-lg font-semibold text-white">Properties</h3>
        </div>
        <p class="text-gray-400 text-sm">Class properties, computed properties, and delegates</p>
      </div>
      <div class="p-4 bg-gray-800 rounded-lg border border-gray-700">
        <div class="flex items-center gap-2 mb-2">
          <div class="w-2 h-2 bg-emerald-500 rounded-full"></div>
          <h3 class="text-lg font-semibold text-white">Data Classes</h3>
        </div>
        <p class="text-gray-400 text-sm">Data classes with generated methods</p>
      </div>
      <div class="p-4 bg-gray-800 rounded-lg border border-gray-700">
        <div class="flex items-center gap-2 mb-2">
          <div class="w-2 h-2 bg-emerald-500 rounded-full"></div>
          <h3 class="text-lg font-semibold text-white">Object Declarations</h3>
        </div>
        <p class="text-gray-400 text-sm">Singleton objects and companion objects</p>
      </div>
    </div>
  </section>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-white mb-4">Setup Requirements</h2>

    <h3 class="text-xl font-semibold text-white mt-6 mb-4">1. Install Kotlin Language Server</h3>

    <CodeBlock
      title="macOS (Homebrew)"
      lang="bash"
      code={`brew install kotlin-language-server`}
    />

    <CodeBlock
      title="Manual Installation"
      lang="bash"
      code={`# Download the latest release from GitHub
curl -L -o kotlin-language-server.zip \\
  https://github.com/fwcd/kotlin-language-server/releases/latest/download/server.zip

# Extract and add to PATH
unzip kotlin-language-server.zip -d ~/.local/
export PATH="$PATH:$HOME/.local/server/bin"`}
    />

    <h3 class="text-xl font-semibold text-white mt-8 mb-4">2. Project Requirements</h3>
    <p class="text-gray-300 mb-4">
      Ensure your Kotlin project has a valid build configuration:
    </p>
    <ul class="list-disc list-inside text-gray-300 space-y-2 ml-4">
      <li><code class="px-2 py-1 bg-gray-800 rounded text-emerald-400">build.gradle.kts</code> or <code class="px-2 py-1 bg-gray-800 rounded text-emerald-400">build.gradle</code> for Gradle projects</li>
      <li><code class="px-2 py-1 bg-gray-800 rounded text-emerald-400">pom.xml</code> for Maven projects</li>
      <li>Proper Kotlin SDK configuration</li>
    </ul>
  </section>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-white mb-4">Example Indexed Code</h2>

    <p class="text-gray-300 mb-4">
      Here is an example of Kotlin code that CodeGraph can fully index and analyze:
    </p>

    <CodeBlock
      title="UserRepository.kt"
      lang="kotlin"
      code={`package com.example.domain.repository

interface UserRepository {
    suspend fun findById(id: UserId): User?
    suspend fun save(user: User): User
    suspend fun delete(id: UserId)
}

data class User(
    val id: UserId,
    val email: Email,
    val name: String,
    val createdAt: Instant
)

@JvmInline
value class UserId(val value: UUID)

@JvmInline
value class Email(val value: String) {
    init {
        require(value.contains("@")) { "Invalid email format" }
    }
}`}
    />

    <CodeBlock
      title="PostgresUserRepository.kt"
      lang="kotlin"
      code={`package com.example.infrastructure.persistence

class PostgresUserRepository(
    private val database: Database
) : UserRepository {

    override suspend fun findById(id: UserId): User? {
        return database.query {
            Users.select { Users.id eq id.value }
                .map { it.toUser() }
                .singleOrNull()
        }
    }

    override suspend fun save(user: User): User {
        database.transaction {
            Users.upsert {
                it[id] = user.id.value
                it[email] = user.email.value
                it[name] = user.name
                it[createdAt] = user.createdAt
            }
        }
        return user
    }

    override suspend fun delete(id: UserId) {
        database.transaction {
            Users.deleteWhere { Users.id eq id.value }
        }
    }
}`}
    />

    <h3 class="text-xl font-semibold text-white mt-8 mb-4">Indexed Symbols</h3>

    <CodeBlock
      title="search_nodes output"
      lang="text"
      code={`type      | Name                    | visibility | filePath:line
----------|-------------------------|------------|----------------------------------
interface | UserRepository          | public     | domain/repository/UserRepository.kt:3
function  | findById                | public     | domain/repository/UserRepository.kt:4
function  | save                    | public     | domain/repository/UserRepository.kt:5
function  | delete                  | public     | domain/repository/UserRepository.kt:6
class     | User                    | public     | domain/repository/UserRepository.kt:9
class     | UserId                  | public     | domain/repository/UserRepository.kt:16
class     | Email                   | public     | domain/repository/UserRepository.kt:19
class     | PostgresUserRepository  | public     | infrastructure/persistence/PostgresUserRepository.kt:5
function  | findById                | public     | infrastructure/persistence/PostgresUserRepository.kt:9
function  | save                    | public     | infrastructure/persistence/PostgresUserRepository.kt:17
function  | delete                  | public     | infrastructure/persistence/PostgresUserRepository.kt:28`}
    />
  </section>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-white mb-4">Kotlin-Specific Features</h2>
    <ul class="list-disc list-inside text-gray-300 space-y-2 ml-4">
      <li><strong>Extension Functions:</strong> Indexed with receiver type information</li>
      <li><strong>Coroutines:</strong> Suspend functions are properly recognized and indexed</li>
      <li><strong>Value Classes:</strong> Inline/value classes are tracked as distinct types</li>
      <li><strong>Sealed Hierarchies:</strong> Sealed class variants are linked to their parent</li>
      <li><strong>Companion Objects:</strong> Factory methods and constants are indexed</li>
    </ul>
  </section>

  <Callout type="tip" title="Spring Boot Support">
    For Spring Boot Kotlin projects, CodeGraph automatically recognizes annotations like
    <code class="text-emerald-400">@Service</code>, <code class="text-emerald-400">@Repository</code>,
    and <code class="text-emerald-400">@Controller</code> for enhanced dependency analysis.
  </Callout>

  <Callout type="warning" title="Gradle Sync">
    If the language server fails to start, ensure your Gradle project is properly synced.
    Run <code class="text-emerald-400">./gradlew build</code> once to generate necessary metadata.
  </Callout>

  <PrevNext
    prev={{ title: "goToImplementation", href: "/docs/lsp/go-to-implementation" }}
    next={{ title: "Java", href: "/docs/languages/java" }}
  />
</DocsLayout>
