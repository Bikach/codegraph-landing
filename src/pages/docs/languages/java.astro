---
import DocsLayout from '../../../layouts/Docs.astro';
import CodeBlock from '../../../components/docs/CodeBlock.astro';
import Callout from '../../../components/docs/Callout.astro';
import PrevNext from '../../../components/docs/PrevNext.astro';
---

<DocsLayout title="Java Support" description="Full Java support via Eclipse JDT Language Server for code indexing and analysis">
  <h1 class="text-4xl font-bold text-white mb-4">Java Support</h1>
  <p class="text-xl text-gray-400 mb-8">
    Full Java support via Eclipse JDT Language Server for comprehensive code indexing and analysis.
  </p>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-white mb-4">Overview</h2>
    <p class="text-gray-300 mb-4">
      CodeGraph provides robust Java support through integration with the
      <a href="https://github.com/eclipse-jdtls/eclipse.jdt.ls" target="_blank" rel="noopener" class="text-emerald-400 hover:text-emerald-300 underline">Eclipse JDT Language Server</a> (jdtls).
      This enables comprehensive code intelligence for Java projects of any size, from small applications to large enterprise codebases.
    </p>
  </section>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-white mb-4">Supported Features</h2>
    <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
      <div class="p-4 bg-gray-800 rounded-lg border border-gray-700">
        <div class="flex items-center gap-2 mb-2">
          <div class="w-2 h-2 bg-emerald-500 rounded-full"></div>
          <h3 class="text-lg font-semibold text-white">Classes</h3>
        </div>
        <p class="text-gray-400 text-sm">Regular classes, abstract classes, and inner classes</p>
      </div>
      <div class="p-4 bg-gray-800 rounded-lg border border-gray-700">
        <div class="flex items-center gap-2 mb-2">
          <div class="w-2 h-2 bg-emerald-500 rounded-full"></div>
          <h3 class="text-lg font-semibold text-white">Interfaces</h3>
        </div>
        <p class="text-gray-400 text-sm">Interface declarations with default methods</p>
      </div>
      <div class="p-4 bg-gray-800 rounded-lg border border-gray-700">
        <div class="flex items-center gap-2 mb-2">
          <div class="w-2 h-2 bg-emerald-500 rounded-full"></div>
          <h3 class="text-lg font-semibold text-white">Methods</h3>
        </div>
        <p class="text-gray-400 text-sm">Instance methods, static methods, and constructors</p>
      </div>
      <div class="p-4 bg-gray-800 rounded-lg border border-gray-700">
        <div class="flex items-center gap-2 mb-2">
          <div class="w-2 h-2 bg-emerald-500 rounded-full"></div>
          <h3 class="text-lg font-semibold text-white">Fields</h3>
        </div>
        <p class="text-gray-400 text-sm">Instance fields, static fields, and constants</p>
      </div>
      <div class="p-4 bg-gray-800 rounded-lg border border-gray-700">
        <div class="flex items-center gap-2 mb-2">
          <div class="w-2 h-2 bg-emerald-500 rounded-full"></div>
          <h3 class="text-lg font-semibold text-white">Annotations</h3>
        </div>
        <p class="text-gray-400 text-sm">Annotation types and their usages</p>
      </div>
      <div class="p-4 bg-gray-800 rounded-lg border border-gray-700">
        <div class="flex items-center gap-2 mb-2">
          <div class="w-2 h-2 bg-emerald-500 rounded-full"></div>
          <h3 class="text-lg font-semibold text-white">Enums</h3>
        </div>
        <p class="text-gray-400 text-sm">Enum types and their constants</p>
      </div>
    </div>
  </section>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-white mb-4">Setup Requirements</h2>

    <Callout type="tip" title="Automatic Installation with Claude Plugin">
      When using CodeGraph as a Claude Plugin, the Java Language Server is installed automatically. Simply run:
      <CodeBlock
        lang="bash"
        code={`/codegraph:setup java`}
      />
      This command downloads and configures Eclipse JDT Language Server automatically. Skip the manual installation steps below if using the plugin.
    </Callout>

    <h3 class="text-xl font-semibold text-white mt-6 mb-4">1. Install Eclipse JDT Language Server</h3>

    <CodeBlock
      title="macOS (Homebrew)"
      lang="bash"
      code={`brew install jdtls`}
    />

    <CodeBlock
      title="Manual Installation"
      lang="bash"
      code={`# Download the latest release from Eclipse
curl -L -o jdtls.tar.gz \\
  https://download.eclipse.org/jdtls/snapshots/jdt-language-server-latest.tar.gz

# Extract to installation directory
mkdir -p ~/.local/jdtls
tar -xzf jdtls.tar.gz -C ~/.local/jdtls

# Add to PATH (add to your shell profile)
export PATH="$PATH:$HOME/.local/jdtls/bin"`}
    />

    <h3 class="text-xl font-semibold text-white mt-8 mb-4">2. Java Runtime</h3>
    <p class="text-gray-300 mb-4">
      JDT Language Server requires Java 17 or later:
    </p>

    <CodeBlock
      title="Verify Java Version"
      lang="bash"
      code={`java --version
# Should output: openjdk 17.0.x or higher`}
    />

    <h3 class="text-xl font-semibold text-white mt-8 mb-4">3. Project Requirements</h3>
    <p class="text-gray-300 mb-4">
      Ensure your Java project has a valid build configuration:
    </p>
    <ul class="list-disc list-inside text-gray-300 space-y-2 ml-4">
      <li><code class="px-2 py-1 bg-gray-800 rounded text-emerald-400">pom.xml</code> for Maven projects</li>
      <li><code class="px-2 py-1 bg-gray-800 rounded text-emerald-400">build.gradle</code> for Gradle projects</li>
      <li><code class="px-2 py-1 bg-gray-800 rounded text-emerald-400">.classpath</code> and <code class="px-2 py-1 bg-gray-800 rounded text-emerald-400">.project</code> for Eclipse projects</li>
    </ul>
  </section>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-white mb-4">Example Indexed Code</h2>

    <p class="text-gray-300 mb-4">
      Here is an example of Java code that CodeGraph can fully index and analyze:
    </p>

    <CodeBlock
      title="UserRepository.java"
      lang="java"
      code={`package com.example.domain.repository;

import java.util.Optional;

public interface UserRepository {
    Optional<User> findById(UserId id);
    User save(User user);
    void delete(UserId id);
    boolean existsByEmail(Email email);
}`}
    />

    <CodeBlock
      title="User.java"
      lang="java"
      code={`package com.example.domain.model;

import java.time.Instant;
import java.util.Objects;

public final class User {
    private final UserId id;
    private final Email email;
    private final String name;
    private final Instant createdAt;

    public User(UserId id, Email email, String name, Instant createdAt) {
        this.id = Objects.requireNonNull(id, "id cannot be null");
        this.email = Objects.requireNonNull(email, "email cannot be null");
        this.name = Objects.requireNonNull(name, "name cannot be null");
        this.createdAt = Objects.requireNonNull(createdAt, "createdAt cannot be null");
    }

    public UserId getId() { return id; }
    public Email getEmail() { return email; }
    public String getName() { return name; }
    public Instant getCreatedAt() { return createdAt; }
}`}
    />

    <CodeBlock
      title="JpaUserRepository.java"
      lang="java"
      code={`package com.example.infrastructure.persistence;

import org.springframework.stereotype.Repository;
import jakarta.persistence.EntityManager;
import jakarta.persistence.PersistenceContext;

@Repository
public class JpaUserRepository implements UserRepository {

    @PersistenceContext
    private EntityManager entityManager;

    @Override
    public Optional<User> findById(UserId id) {
        UserEntity entity = entityManager.find(UserEntity.class, id.getValue());
        return Optional.ofNullable(entity).map(this::toDomain);
    }

    @Override
    public User save(User user) {
        UserEntity entity = toEntity(user);
        entityManager.persist(entity);
        return user;
    }

    @Override
    public void delete(UserId id) {
        UserEntity entity = entityManager.find(UserEntity.class, id.getValue());
        if (entity != null) {
            entityManager.remove(entity);
        }
    }

    @Override
    public boolean existsByEmail(Email email) {
        return entityManager.createQuery(
            "SELECT COUNT(u) > 0 FROM UserEntity u WHERE u.email = :email",
            Boolean.class
        )
        .setParameter("email", email.getValue())
        .getSingleResult();
    }
}`}
    />

    <h3 class="text-xl font-semibold text-white mt-8 mb-4">Indexed Symbols</h3>

    <CodeBlock
      title="search_nodes output"
      lang="text"
      code={`type      | Name               | visibility | filePath:line
----------|--------------------|------------|----------------------------------
interface | UserRepository     | public     | domain/repository/UserRepository.java:5
function  | findById           | public     | domain/repository/UserRepository.java:6
function  | save               | public     | domain/repository/UserRepository.java:7
function  | delete             | public     | domain/repository/UserRepository.java:8
function  | existsByEmail      | public     | domain/repository/UserRepository.java:9
class     | User               | public     | domain/model/User.java:7
property  | id                 | private    | domain/model/User.java:8
property  | email              | private    | domain/model/User.java:9
property  | name               | private    | domain/model/User.java:10
property  | createdAt          | private    | domain/model/User.java:11
class     | JpaUserRepository  | public     | infrastructure/persistence/JpaUserRepository.java:9
function  | findById           | public     | infrastructure/persistence/JpaUserRepository.java:15
function  | save               | public     | infrastructure/persistence/JpaUserRepository.java:21
function  | delete             | public     | infrastructure/persistence/JpaUserRepository.java:27
function  | existsByEmail      | public     | infrastructure/persistence/JpaUserRepository.java:34`}
    />
  </section>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-white mb-4">Java-Specific Features</h2>
    <ul class="list-disc list-inside text-gray-300 space-y-2 ml-4">
      <li><strong>Annotation Processing:</strong> Framework annotations (Spring, JPA, etc.) are recognized</li>
      <li><strong>Generic Types:</strong> Type parameters and bounds are tracked</li>
      <li><strong>Records:</strong> Java 16+ record types are fully supported</li>
      <li><strong>Sealed Classes:</strong> Java 17+ sealed hierarchies are indexed</li>
      <li><strong>Module System:</strong> Java 9+ module declarations are recognized</li>
    </ul>
  </section>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-white mb-4">Framework Support</h2>
    <div class="grid gap-4 md:grid-cols-2">
      <div class="p-4 bg-gray-800 rounded-lg border border-gray-700">
        <h3 class="text-lg font-semibold text-emerald-400 mb-2">Spring Boot</h3>
        <p class="text-gray-400 text-sm">Full support for <code>@Service</code>, <code>@Repository</code>, <code>@Controller</code>, <code>@Component</code>, and dependency injection analysis</p>
      </div>
      <div class="p-4 bg-gray-800 rounded-lg border border-gray-700">
        <h3 class="text-lg font-semibold text-emerald-400 mb-2">Jakarta EE</h3>
        <p class="text-gray-400 text-sm">Recognition of <code>@Entity</code>, <code>@Inject</code>, <code>@EJB</code>, and other Jakarta annotations</p>
      </div>
      <div class="p-4 bg-gray-800 rounded-lg border border-gray-700">
        <h3 class="text-lg font-semibold text-emerald-400 mb-2">Quarkus</h3>
        <p class="text-gray-400 text-sm">Support for CDI beans and Quarkus-specific extensions</p>
      </div>
      <div class="p-4 bg-gray-800 rounded-lg border border-gray-700">
        <h3 class="text-lg font-semibold text-emerald-400 mb-2">Micronaut</h3>
        <p class="text-gray-400 text-sm">Compile-time DI and annotation processing support</p>
      </div>
    </div>
  </section>

  <Callout type="tip" title="Large Codebases">
    For large Java projects, consider increasing JVM heap size for jdtls by setting
    <code class="text-emerald-400">JAVA_OPTS="-Xmx4g"</code> before starting the indexing process.
  </Callout>

  <Callout type="warning" title="Build First">
    For accurate indexing, ensure your project compiles successfully before running CodeGraph.
    Run <code class="text-emerald-400">mvn compile</code> or <code class="text-emerald-400">./gradlew build</code> first.
  </Callout>

  <Callout type="info" title="Multi-Module Projects">
    CodeGraph handles Maven and Gradle multi-module projects. Each module's symbols are indexed
    with proper cross-module reference resolution.
  </Callout>

  <PrevNext
    prev={{ title: "Kotlin", href: "/docs/languages/kotlin" }}
    next={{ title: "Benchmark", href: "/docs/benchmark" }}
  />
</DocsLayout>
