---
import DocsLayout from '../../../layouts/Docs.astro';
import CodeBlock from '../../../components/docs/CodeBlock.astro';
import Callout from '../../../components/docs/Callout.astro';
import PrevNext from '../../../components/docs/PrevNext.astro';
import { url } from '../../../utils/paths';
---

<DocsLayout title="/codegraph:setup">
  <h1 class="text-4xl font-bold text-text-primary mb-4">/codegraph:setup</h1>
  <p class="text-xl text-text-secondary mb-8">
    Starts Neo4j Docker container and prepares the database for CodeGraph.
  </p>

  <h2 class="text-2xl font-semibold text-text-primary mt-10 mb-4">Overview</h2>
  <p class="text-text-secondary mb-4">
    The <code class="bg-bg-subtle px-2 py-1 rounded text-primary">/codegraph:setup</code> command initializes the Neo4j graph database environment required by CodeGraph. This is the first command you should run when setting up CodeGraph for a new project.
  </p>

  <h2 class="text-2xl font-semibold text-text-primary mt-10 mb-4">What it does</h2>
  <ul class="list-disc list-inside text-text-secondary space-y-2 mb-6">
    <li>Checks Docker is running</li>
    <li>Starts the Neo4j container</li>
    <li>Waits for Neo4j to be ready</li>
    <li>Creates indexes and constraints</li>
    <li>Installs tree-sitter native dependencies (required for parsing)</li>
    <li>Installs Language Server if language specified (optional)</li>
  </ul>

  <h2 class="text-2xl font-semibold text-text-primary mt-10 mb-4">Usage</h2>
  <p class="text-text-secondary mb-4">
    Simply invoke the command in your Claude Code session:
  </p>

  <CodeBlock
    code="/codegraph:setup"
    lang="bash"
    title="Claude Code"
  />

  <h2 class="text-2xl font-semibold text-text-primary mt-10 mb-4">Options</h2>
  <p class="text-text-secondary mb-4">
    You can optionally specify a language server to install:
  </p>

  <div class="overflow-x-auto mb-6">
    <table class="w-full text-sm text-left text-text-secondary">
      <thead class="text-xs uppercase bg-bg-subtle text-text-muted">
        <tr>
          <th class="px-4 py-3 rounded-tl-lg">Argument</th>
          <th class="px-4 py-3 rounded-tr-lg">Description</th>
        </tr>
      </thead>
      <tbody class="bg-bg-subtle">
        <tr class="border-b border-border">
          <td class="px-4 py-3 font-medium text-text-primary"><code class="text-primary">kotlin</code></td>
          <td class="px-4 py-3">Install Kotlin Language Server (<code class="text-primary">kotlin-language-server</code>) for LSP features</td>
        </tr>
        <tr>
          <td class="px-4 py-3 font-medium text-text-primary"><code class="text-primary">java</code></td>
          <td class="px-4 py-3">Install Java Language Server (<code class="text-primary">jdtls</code>) for LSP features</td>
        </tr>
      </tbody>
    </table>
  </div>

  <h3 class="text-xl font-semibold text-text-primary mt-8 mb-3">Examples</h3>

  <CodeBlock
    code={`/codegraph:setup              # Neo4j only
/codegraph:setup kotlin       # Neo4j + Kotlin LSP
/codegraph:setup java         # Neo4j + Java LSP`}
    lang="bash"
    title="Claude Code"
  />

  <Callout type="tip" title="LSP Integration">
    Installing a language server enables more accurate code navigation features like <code class="bg-bg-subtle px-2 py-0.5 rounded text-primary">incomingCalls</code> and <code class="bg-bg-subtle px-2 py-0.5 rounded text-primary">goToImplementation</code>.
  </Callout>

  <h2 class="text-2xl font-semibold text-text-primary mt-10 mb-4">Example Output</h2>
  <CodeBlock
    code={`> /codegraph:setup

⏺ Bash(bash ".../codegraph/scripts/setup.sh")
  ⎿  {
       "success": true,
       "docker": true,
       "container": true,
       "neo4j": true,
       "indexes": true,
       "message": "Neo4j is ready",
       "neo4jUri": "bolt://localhost:7687",
       "browserUrl": "http://localhost:7474"
     }
     {
       "step": "tree_sitter",
       "status": "ok",
       "message": "tree-sitter already installed"
     }`}
    lang="bash"
    title="Claude Code"
    copyable={false}
  />

  <Callout type="tip" title="Docker Required">
    This command requires Docker to be installed and running on your machine. Make sure the Docker daemon is active before running this command.
  </Callout>

  <h2 class="text-2xl font-semibold text-text-primary mt-10 mb-4">Container Configuration</h2>
  <p class="text-text-secondary mb-4">
    The setup command creates a container with the following default configuration:
  </p>

  <div class="overflow-x-auto mb-6">
    <table class="w-full text-sm text-left text-text-secondary">
      <thead class="text-xs uppercase bg-bg-subtle text-text-muted">
        <tr>
          <th class="px-4 py-3 rounded-tl-lg">Setting</th>
          <th class="px-4 py-3 rounded-tr-lg">Value</th>
        </tr>
      </thead>
      <tbody class="bg-bg-subtle">
        <tr class="border-b border-border">
          <td class="px-4 py-3 font-medium text-text-primary">Container Name</td>
          <td class="px-4 py-3"><code class="text-primary">codegraph-neo4j</code></td>
        </tr>
        <tr class="border-b border-border">
          <td class="px-4 py-3 font-medium text-text-primary">Bolt Port</td>
          <td class="px-4 py-3"><code class="text-primary">7687</code></td>
        </tr>
        <tr class="border-b border-border">
          <td class="px-4 py-3 font-medium text-text-primary">HTTP Port</td>
          <td class="px-4 py-3"><code class="text-primary">7474</code></td>
        </tr>
        <tr>
          <td class="px-4 py-3 font-medium text-text-primary">Authentication</td>
          <td class="px-4 py-3"><code class="text-primary">Disabled (local development)</code></td>
        </tr>
      </tbody>
    </table>
  </div>

  <Callout type="info" title="Persistent Data">
    The Neo4j data is stored in a Docker volume, so your indexed code graph persists between container restarts.
  </Callout>

  <h2 class="text-2xl font-semibold text-text-primary mt-10 mb-4">Next Steps</h2>
  <p class="text-text-secondary mb-4">
    After setting up Neo4j, you can index your codebase using the <a href={url('/docs/commands/index-cmd')} class="text-primary hover:text-secondary underline">/codegraph:index</a> command.
  </p>

  <PrevNext
    prev={{ title: "MCP Standalone", href: "/docs/installation/mcp-standalone" }}
    next={{ title: "/codegraph:index", href: "/docs/commands/index-cmd" }}
  />
</DocsLayout>
