---
interface Step {
  number: number;
  title: string;
  description: string;
  icon: string;
}

const steps: Step[] = [
  {
    number: 1,
    title: "Index",
    description: "Parse your code with tree-sitter, build relationships",
    icon: "document",
  },
  {
    number: 2,
    title: "Store",
    description: "Write to Neo4j graph with classes, functions, calls, dependencies",
    icon: "database",
  },
  {
    number: 3,
    title: "Query",
    description: "Claude asks the graph instead of reading files",
    icon: "lightning",
  },
];
---

<section id="how-it-works" class="relative py-24 lg:py-32 bg-[var(--color-bg-subtle)]">
  <div class="relative mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <!-- Section header -->
    <div class="text-center mb-16 lg:mb-20">
      <h2 class="text-3xl font-bold tracking-tight sm:text-4xl lg:text-5xl">
        <span class="gradient-text">How It Works</span>
      </h2>
      <p class="mt-4 text-lg text-[var(--color-text-secondary)] max-w-2xl mx-auto">
        Three simple steps to give Claude deep understanding of your codebase
      </p>
    </div>

    <!-- Steps - Horizontal on desktop, vertical on mobile -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 lg:gap-8 mb-16 lg:mb-24">
      {steps.map((step, index) => (
        <div class="relative group">
          <!-- Connection line (hidden on mobile, shown between cards on desktop) -->
          {index < steps.length - 1 && (
            <div class="hidden md:block absolute top-16 left-[calc(50%+60px)] w-[calc(100%-120px)] h-0.5 bg-[var(--color-border)] z-0"></div>
          )}

          <!-- Step card -->
          <div class="glass-card p-6 lg:p-8 h-full transition-colors duration-200 relative z-10">
            <!-- Step number badge -->
            <div class="flex items-center justify-center w-10 h-10 mb-6 rounded-full bg-[var(--color-primary)] text-white font-semibold text-base">
              {step.number}
            </div>

            <!-- Icon -->
            <div class="mb-4 text-[var(--color-primary)]">
              {step.icon === "document" && (
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                </svg>
              )}
              {step.icon === "database" && (
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125" />
                </svg>
              )}
              {step.icon === "lightning" && (
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" />
                </svg>
              )}
            </div>

            <!-- Title -->
            <h3 class="text-xl font-semibold text-[var(--color-text-primary)] mb-2">
              {step.title}
            </h3>

            <!-- Description -->
            <p class="text-[var(--color-text-secondary)] leading-relaxed">
              {step.description}
            </p>
          </div>

          <!-- Mobile connector (shown between cards on mobile) -->
          {index < steps.length - 1 && (
            <div class="md:hidden flex justify-center mt-0 -mb-7 relative z-10">
              <div class="bg-[var(--color-bg-dark)] rounded-full p-1.5">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[var(--color-primary)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
                </svg>
              </div>
            </div>
          )}
        </div>
      ))}
    </div>

    <!-- Architecture diagram -->
    <div class="glass-card p-6 lg:p-10">
      <h3 class="text-center text-lg font-semibold text-[var(--color-text-secondary)] mb-8">
        Architecture Overview
      </h3>

      <!-- Diagram container -->
      <div class="flex flex-col lg:flex-row items-center justify-center gap-4 lg:gap-6 text-sm lg:text-base">
        <!-- Your Codebase -->
        <div class="flex items-center gap-3 px-4 py-3 rounded-md bg-[var(--color-bg-subtle)] border border-[var(--color-border)] min-w-[140px] justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[var(--color-text-muted)] flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z" />
          </svg>
          <span class="text-[var(--color-text-secondary)] font-medium">Your Codebase</span>
        </div>

        <!-- Arrow -->
        <div class="text-[var(--color-text-muted)] rotate-90 lg:rotate-0">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
          </svg>
        </div>

        <!-- CodeGraph Indexer -->
        <div class="flex items-center gap-3 px-4 py-3 rounded-md bg-[var(--color-primary)]/5 border border-[var(--color-primary)]/20 min-w-[160px] justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[var(--color-primary)] flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
          <span class="text-[var(--color-primary)] font-medium">CodeGraph Indexer</span>
        </div>

        <!-- Arrow -->
        <div class="text-[var(--color-text-muted)] rotate-90 lg:rotate-0">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
          </svg>
        </div>

        <!-- Neo4j Graph (center piece) -->
        <div class="flex items-center gap-3 px-5 py-4 rounded-md bg-[var(--color-secondary)]/10 border border-[var(--color-secondary)]/30 min-w-[140px] justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-[var(--color-secondary)] flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 14.25v2.25m3-4.5v4.5m3-6.75v6.75m3-9v9M6 20.25h12A2.25 2.25 0 0020.25 18V6A2.25 2.25 0 0018 3.75H6A2.25 2.25 0 003.75 6v12A2.25 2.25 0 006 20.25z" />
          </svg>
          <span class="text-[var(--color-secondary)] font-semibold">Neo4j Graph</span>
        </div>

        <!-- Bidirectional arrows -->
        <div class="text-[var(--color-text-muted)] rotate-90 lg:rotate-0">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5" />
          </svg>
        </div>

        <!-- MCP Server -->
        <div class="flex items-center gap-3 px-4 py-3 rounded-md bg-[var(--color-secondary)]/5 border border-[var(--color-secondary)]/20 min-w-[140px] justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[var(--color-secondary)] flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 14.25h13.5m-13.5 0a3 3 0 01-3-3m3 3a3 3 0 100 6h13.5a3 3 0 100-6m-16.5-3a3 3 0 013-3h13.5a3 3 0 013 3m-19.5 0a4.5 4.5 0 01.9-2.7L5.737 5.1a3.375 3.375 0 012.7-1.35h7.126c1.062 0 2.062.5 2.7 1.35l2.587 3.45a4.5 4.5 0 01.9 2.7m0 0a3 3 0 01-3 3m0 3h.008v.008h-.008v-.008zm0-6h.008v.008h-.008v-.008zm-3 6h.008v.008h-.008v-.008zm0-6h.008v.008h-.008v-.008z" />
          </svg>
          <span class="text-[var(--color-secondary)] font-medium">MCP Server</span>
        </div>

        <!-- Arrow -->
        <div class="text-[var(--color-text-muted)] rotate-90 lg:rotate-0">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5" />
          </svg>
        </div>

        <!-- Claude -->
        <div class="flex items-center gap-3 px-4 py-3 rounded-md bg-[var(--color-attention)]/10 border border-[var(--color-attention)]/20 min-w-[120px] justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[var(--color-attention)] flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z" />
          </svg>
          <span class="text-[var(--color-attention)] font-medium">Claude</span>
        </div>
      </div>

      <!-- Caption -->
      <p class="text-center text-[var(--color-text-muted)] text-sm mt-8">
        Claude queries the graph for precise code navigation instead of scanning thousands of files
      </p>
    </div>
  </div>
</section>
