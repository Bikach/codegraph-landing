---
import { url } from '../../utils/paths';

interface Props {
  currentPath: string;
}

const { currentPath } = Astro.props;

interface NavItem {
  label: string;
  href?: string;
  children?: NavItem[];
  special?: "green";
}

interface NavSection {
  title?: string;
  items: NavItem[];
}

const navigation: NavSection[] = [
  {
    items: [
      { label: "Getting Started", href: "/docs/getting-started" },
      {
        label: "Installation",
        children: [
          { label: "Claude Plugin", href: "/docs/installation/claude-plugin" },
          { label: "MCP Standalone", href: "/docs/installation/mcp-standalone" },
        ],
      },
      {
        label: "Commands (plugin)",
        children: [
          { label: "/codegraph:setup", href: "/docs/commands/setup" },
          { label: "/codegraph:index", href: "/docs/commands/index-cmd" },
          { label: "/codegraph:status", href: "/docs/commands/status" },
        ],
      },
      {
        label: "MCP Tools",
        children: [
          { label: "search_nodes", href: "/docs/tools/search-nodes" },
          { label: "get_callers", href: "/docs/tools/get-callers" },
          { label: "get_callees", href: "/docs/tools/get-callees" },
          { label: "get_neighbors", href: "/docs/tools/get-neighbors" },
          { label: "get_implementations", href: "/docs/tools/get-implementations" },
          { label: "get_impact", href: "/docs/tools/get-impact" },
          { label: "find_path", href: "/docs/tools/find-path" },
          { label: "get_file_symbols", href: "/docs/tools/get-file-symbols" },
        ],
      },
      {
        label: "LSP Tools",
        children: [
          { label: "incomingCalls", href: "/docs/lsp/incoming-calls" },
          { label: "goToImplementation", href: "/docs/lsp/go-to-implementation" },
        ],
      },
      {
        label: "Languages",
        children: [
          { label: "Kotlin", href: "/docs/languages/kotlin" },
          { label: "Java", href: "/docs/languages/java" },
        ],
      },
      {
        label: "Benchmark",
        children: [
          { label: "Results", href: "/docs/benchmark" },
        ],
      },
    ],
  },
];

function isActive(href: string): boolean {
  return currentPath === href || currentPath === href + "/";
}

function isChildActive(item: NavItem): boolean {
  if (item.children) {
    return item.children.some((child) => child.href && isActive(child.href));
  }
  return false;
}
---

<aside class="w-64 bg-bg-subtle border-r border-border h-screen overflow-y-auto sticky top-0 scrollbar-custom">
  <nav class="p-4 space-y-6">
    {navigation.map((section) => (
      <div>
        {section.title && (
          <h3 class="text-[11px] font-bold uppercase tracking-widest text-text-muted mb-3 px-3 pt-2 border-t border-border">
            {section.title}
          </h3>
        )}
        <ul class="space-y-1">
          {section.items.map((item) => (
            <li>
              {item.href ? (
                <a
                  href={url(item.href)}
                  class:list={[
                    "block px-3 py-2 rounded-md text-sm transition-colors duration-150",
                    item.special === "green"
                      ? isActive(item.href)
                        ? "bg-secondary/10 text-secondary border-l-2 border-secondary"
                        : "text-secondary hover:text-secondary hover:bg-secondary/5"
                      : isActive(item.href)
                        ? "bg-primary/10 text-primary border-l-2 border-primary"
                        : "text-text-secondary hover:text-text-primary hover:bg-surface-hover",
                  ]}
                >
                  {item.label}
                </a>
              ) : item.children ? (
                <div>
                  <span
                    class:list={[
                      "block px-3 py-2 text-sm font-medium",
                      isChildActive(item)
                        ? "text-primary"
                        : "text-text-primary",
                    ]}
                  >
                    {item.label}
                  </span>
                  <ul class="ml-3 space-y-1 border-l border-border">
                    {item.children.map((child) => (
                      <li>
                        <a
                          href={child.href ? url(child.href) : '#'}
                          class:list={[
                            "block px-3 py-1.5 rounded-md text-sm transition-colors duration-150",
                            child.special === "green"
                              ? child.href && isActive(child.href)
                                ? "bg-secondary/10 text-secondary border-l-2 border-secondary -ml-px"
                                : "text-secondary hover:text-secondary hover:bg-secondary/5"
                              : child.href && isActive(child.href)
                                ? "bg-primary/10 text-primary border-l-2 border-primary -ml-px"
                                : "text-text-muted hover:text-text-secondary hover:bg-surface-hover",
                          ]}
                        >
                          {child.label}
                        </a>
                      </li>
                    ))}
                  </ul>
                </div>
              ) : null}
            </li>
          ))}
        </ul>
      </div>
    ))}
  </nav>
</aside>
